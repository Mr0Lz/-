<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<link rel="stylesheet" href="./css/index_pay.css">
	<script type="text/javascript">
	        //最优先 rem布局代码
	        (function (d, w) {
	            var docEle = document.documentElement,
	                    resizeE = 'orientationchange' in window ? 'orientationchange' : 'resize',
	                    wResize = function () {
	                        var  clientWidth = docEle.clientWidth;
	                        if (!clientWidth) return;
	                        //px转换rem:px/100    设计图1920   基数:100
	                        docEle.style.fontSize = 100 * (clientWidth / 1920) + 'px';
	                    }
	            if (!d.addEventListener) return;
	            w.addEventListener(resizeE , wResize , false);
	            //在dom加载完后执行一遍
	            d.addEventListener('DOMContentLoaded' , wResize ,false);

	        })(document, window)

	</script>
	<script type="text/javascript" src="./js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="./js/echarts.min.js"></script>
    <script type="text/javascript" src="./js/vue.min.js"></script>
	<script type="text/javascript" >
	    //地图对象
	    echarts.extendsMap = function(id, opt){
	        // 实例
	        var chart = this.init(document.getElementById(id));

	        // 深圳地理坐标
	        var shenzhen = "./js/shenzhenshi.json";
	        $.ajaxSettings.async=false;//设置getjson同步，使用后重新恢复异步
	        $.getJSON(shenzhen, function(geoJson) {
	            echarts.registerMap('深圳市',geoJson);
	        });
	        $.ajaxSettings.async=true;

	        var curGeoJson = {};//下钻的地理json

	        //下钻的json数据
	        var cityMap = {
	            "深圳市": shenzhen
	        };
	        //点的位置
	        var geoCoordMap = {
	            '深圳市': [ 114.027099609375,22.717923537632178],
	            '龙华区': [114.027099609375,22.717923537632178],
	            '光明新区':[113.93852233886719,22.77301594961187],
	            '大鹏新区':[114.50431823730469,22.607038308040828],
	            '坪山区':[114.35050964355469,22.67738161936916],
	            '龙岗区':[114.25437927246094,22.743889395219064],
	            '盐田区':[114.27635192871094,22.574072303523796],
	            '罗湖区':[114.14794921875,22.553781610660607],
	            '福田区':[114.04769897460938,22.52016858599439],
	            '南山区':[113.96186828613281,22.585484505801283],
	            '宝安区':[113.82865905761719,22.642531328085155]
	        };
	        //点的颜色
	        var cityConfig = opt.cityConfig ||  {
	            color : 'rgba(241, 109, 115, .8)',
	            color : 'rgba(255, 235, 59, .7)',
	            color : 'rgba(147, 235, 248, 1)'
	        };

	        //默认配置
	        var defaultOpt = {
	            mapName: 'china',     // 地图展示
	            goDown: false,        // 是否下钻
	            bgColor: '#404a59',   // 画布背景色
	            activeArea: [],       // 区域高亮,同echarts配置项
	            data: [],
	            // 下钻回调(点击的地图名、实例对象option、实例对象)
	            callback: function(name, option, instance){}
	        };
	        if(opt) opt = this.util.extend(defaultOpt, opt);

	        // 层级索引  标题
	        var name = [opt.mapName];
	        var idx = 0;
	        var pos = {
	            leftPlus: 50,//2级标题偏移
	            leftCur: 8,//2级标题偏移
	            left: 0,//1级标题偏移
	            top: 10//1级标题偏移
	        };

	        //标题的箭头
	        var line = [[0, 0], [8, 11], [0, 22]];
	        // style 通用的样式
	        var style = {
	            font: '18px "Microsoft YaHei", sans-serif',
	            textColor: '#eee',
	            lineColor: 'rgba(147, 235, 248, .8)'
	        };

	        var handleEvents = {
	            /**
	             * i 实例对象
	             * o option
	             * n 地图名
	             **/
	            resetOption: function(i, o, n){
	                var breadcrumb = this.createBreadcrumb(n);//设置标题组件

	                var j = name.indexOf(n);
	                var l = o.graphic.length;
	                if(j < 0){
	                    o.graphic.push(breadcrumb);
	                    o.graphic[0].children[0].shape.x2 = 145;
	                    o.graphic[0].children[1].shape.x2 = 145;
	                    if(o.graphic.length > 2){
	                        for(var x = 0; x < opt.data.length; x++){
	                            if(n === opt.data[x].name + '市'){
	                                o.series[0].data = handleEvents.initSeriesData([opt.data[x]]);
	                                break;
	                            }else o.series[0].data = [];
	                        }
	                    };
	                    name.push(n);
	                    idx++;
	                }else{
	                    o.graphic.splice(j + 2, l);
	                    if(o.graphic.length <= 2){
	                        o.graphic[0].children[0].shape.x2 = 60;
	                        o.graphic[0].children[1].shape.x2 = 60;
	                        o.series[0].data = handleEvents.initSeriesData(opt.data);
	                    };
	                    name.splice(j + 1, l);
	                    idx = j;
	                    pos.leftCur -= pos.leftPlus * (l - j - 1);
	                };

	                o.geo.map = n;
	                o.geo.zoom = 0.4;
	                i.clear();
	                i.setOption(o);
	                this.zoomAnimation();
	                opt.callback(n, o, i);
	            },

	            /**
	             * name 地图名  标题组件
	             **/
	            createBreadcrumb: function(name){
	                var cityToPinyin = {
	                    "深圳市": "shenzhen",//地图中文 : 地图拼音设置
	                };
	                var breadcrumb = {
	                    type: 'group',
	                    id: name,
	                    left: pos.leftCur + pos.leftPlus,
	                    top: pos.top + 3,
	                    children: [{
	                        type: 'polyline',
	                        left: -90,
	                        top: -5,
	                        shape: {
	                            points: line
	                        },
	                        style: {
	                            stroke: '#fff',
	                            key: name
	                            // lineWidth: 2,
	                        },
	                        onclick: function(){
	                            var name = this.style.key;
	                            handleEvents.resetOption(chart, option, name);
	                        }
	                    }, {
	                        type: 'text',
	                        left: -68,
	                        top: 'middle',
	                        style: {
	                            text: name,
	                            textAlign: 'center',
	                            fill: style.textColor,
	                            font: style.font
	                        },
	                        onclick: function(){
	                            var name = this.style.text;
	                            handleEvents.resetOption(chart, option, name);
	                        }
	                    }, {
	                        type: 'text',
	                        left: -68,
	                        top: 10,
	                        style: {

	                            name: name,
	                            text: cityToPinyin[name] ? cityToPinyin[name].toUpperCase() : '',
	                            textAlign: 'center',
	                            fill: style.textColor,
	                            font: '12px "Microsoft YaHei", sans-serif',
	                        },
	                        onclick: function(){
	                            // console.log(this.style);
	                            var name = this.style.name;
	                            handleEvents.resetOption(chart, option, name);
	                        }
	                    }]
	                }

	                pos.leftCur += pos.leftPlus;

	                return breadcrumb;
	            },

	            // 设置effectscatter
	            initSeriesData: function(data){
	                var temp = [];
	                for(var i = 0;i < data.length;i++){
	                    var geoCoord = geoCoordMap[data[i].name];
	                    if(geoCoord){
	                        var t=[];
	                        for ( objkey in data[i]){
	                            t.push(data[i][objkey]);
	                        }
	                        temp.push({
	                            name: data[i].name,
	                            value: geoCoord.concat(t)   //数据点的值 可以增加其他数据
	                        });
	                    }
	                }
	                console.log(temp,'temp')   //  temp[2] : "宝安区" //name   temp[3]: 10 //payNum   temp[4]: "add20" //payAmt
	                return temp;
	            },

	            zoomAnimation: function(){
	                var count = null;
	                var zoom = function(per){
	                    if(!count) count = per;
	                    count = count + per;
	                    // console.log(per,count);
	                    chart.setOption({
	                        geo: {
	                            zoom: count
	                        }
	                    });
	                    if(count < 1) window.requestAnimationFrame(function(){
	                        zoom(0.2);
	                    });
	                };
	                window.requestAnimationFrame(function(){
	                    zoom(0.2);
	                });
	            }
	        };

	        //初始化标题的配置
	        var option = {
	            backgroundColor: opt.bgColor,
	            graphic: [{  //左上角按钮
	                type: 'group',
	            }],
	            geo: {//地图块
	                map: opt.mapName,
	                roam: true,//拖动,鼠标滚轴
	                zoom: 1.3,
	                label: {
	                    normal: {
	                        show: true,//地图块中的名字
	                        textStyle: {
	                            color: '#fff',
	                            fontSize : "10"
	                        }
	                    },
	                    emphasis: {
	                        textStyle: {//地图块中的名字 的 hover
	                            color: '#fff'
	                        }
	                    }
	                },
	                itemStyle: {//每个地图块
	                    normal: {
	                        //borderColor: 'rgba(147, 235, 248, 1)',//每个地图块的边框颜色
	                        borderColor: '#5491be',
	                        borderWidth: 1,
	                        areaColor: {//填充的颜色
	                            type: 'radial',
	                            x: 0.5,
	                            y: 0.5,
	                            r: 0.8,
	                            colorStops: [{
	                                offset: 0,
	                                //color: 'rgba(147, 235, 248, 0)' // 0% 处的颜色
	                                color: '#174e87'
	                            }, {
	                                offset: 1,
	                                //color: 'rgba(147, 235, 248, .2)' // 100% 处的颜色
	                                color: '#356798'
	                            }],
	                            globalCoord: false // 缺省为 false
	                        },
	                        shadowColor: 'rgba(128, 217, 248, 1)',
	                        // shadowColor: 'rgba(255, 255, 255, 1)',
	                        // shadowOffsetX: -2,
	                        // shadowOffsetY: 2,
	                        // shadowOffsetX: -1,
	                        // shadowOffsetY: 1,
	                        // shadowBlur: 10
	                    },
	                    emphasis: {//每个地图块的hover
	                        areaColor: '#389BB7',
	                        borderWidth: 0
	                    }
	                },
	                regions: opt.activeArea.map(function(item){
	                    if(typeof item !== 'string'){
	                        return {
	                            name: item.name,
	                            itemStyle: {
	                                normal: {
	                                    areaColor: item.areaColor || '#389BB7'
	                                }
	                            },
	                            label: {
	                                normal: {
	                                    show: item.showLabel,
	                                    textStyle: {
	                                        color: '#fff'
	                                    }
	                                }
	                            }
	                        }
	                    }else{
	                        return {
	                            name: item,
	                            itemStyle: {
	                                normal: {
	                                    borderColor: '#91e6ff',
	                                    areaColor: '#389BB7'
	                                }
	                            }
	                        }
	                    }
	                })
	            },
	            tooltip : {
	                formatter: function (params, ticket, callback) {
	                    //  temp[2] : "宝安区" //name   temp[3]: 10 //payNum   temp[4]: "add20" //payAmt
	                    return params.name+"<br>区支付笔数:"+params.value[3]+"笔<br>区支付累计金额:"+params.value[4]+"元";
	                }
	            },
	            series: [{//数据点的样式
	                name: 'point',
	                type: 'effectScatter',
	                coordinateSystem: 'geo',
	                // symbol: 'diamond',
	                showEffectOn: 'render',
	                rippleEffect: {
	                    period: 6,
	                    scale: 3,
	                    brushType: 'fill'
	                },
	                hoverAnimation: true,
	                itemStyle: {
	                    normal: {
	                        color: function(params){
	                            return cityConfig[params.name].color;
	                        },
	                        shadowBlur: 10,
	                        shadowColor: '#333'
	                    }
	                },
	                data: handleEvents.initSeriesData(opt.data)
	            }]
	        };

	        if(opt.data) {
	            chart.setOption(option);
	        }
	        // 添加事件
	        chart.on('click', function(params){
	            var _self = this;
	            if(opt.goDown && params.name !== name[idx]){
	                if(cityMap[params.name]){
	                    var url = cityMap[params.name];
	                    $.get(url, function(response){
	                        // console.log(response);
	                        curGeoJson = response;
	                        echarts.registerMap(params.name, response);
	                        handleEvents.resetOption(_self, option, params.name);
	                    });
	                }
	            }
	        });

	        chart.setMap = function(mapName){
	            var _self = this;
	            if(mapName.indexOf('市') < 0) mapName = mapName + '市';
	            var citySource = cityMap[mapName];
	            if(citySource){
	                var url = './map/' + citySource + '.json';
	                $.get(url, function(response){
	                    // console.log(response);
	                    curGeoJson = response;
	                    echarts.registerMap(mapName, response);
	                    handleEvents.resetOption(_self, option, mapName);
	                });
	            }
	            handleEvents.resetOption(this, option, mapName);
	        };

	        chart.setData  = function (data) {
	            //initSeriesData  调用内部方法 整理数据
	            var _self = this;
	            if(data.length == 0){
	                return ;
	            }
	            _self.setOption({
	                series:[{
	                    name: 'point',
	                    data:handleEvents.initSeriesData(data)
	                }]
	            });
	        };

	        return chart;
	    };
	    //地图 end

	</script>

</head>
<body>
	<div class="bigbg">
		
		<div class="main">  

			<div class="main-h">
				<p class="main-h-title">电子健康卡数据一览平台</p>
				<p class="main-h-time"><img src="./images/time_icon.png"><span>2019年04月25日  04:24:18</span></p>
			</div>

			<!-- 左侧 -->
			<div class="main-l l"> 
				
				<div class="main-l-box l">
					<!--支付趋势（最近6月）  -->
					<div class="mouth-box">
						<p class="box-h">支付趋势（最近6月）</p>	
					</div>
					<!-- 支付趋势（最近7日） -->
					<div class="day-box">
						<p class="box-h">支付趋势（最近7日）</p>
					</div>
					
					<!-- 区域用卡量排行（今日） -->
					<div class="quantity-usage">
						<p class="box-h">区域用卡量排行（今日）</p>
								<ul class="quantity-list">
									<li class="quantity-h">
										<span>排名</span>
										<span>区域</span>
										<span>今日用卡量</span>
									</li>
									<li>
										<span><small>1</small></span>
										<span>宝安区</span>
										<span>123123 231</span>
									</li>
									<li>
										<span><small>2</small></span>
										<span>宝安区</span>
										<span>123123</span>
									</li>
									<li>
										<span><small>3</small></span>
										<span>宝安区</span>
										<span>123123123123</span>
									</li>
									<li>
										<span><small>4</small></span>
										<span>宝安区</span>
										<span></span>
									</li>
									<li>
										<span><small>5</small></span>
										<span>宝安区</span>
										<span>123123123</span>
									</li>
									<li>
										<span><small>6</small></span>
										<span></span>
										<span></span>
									</li>
									<li>
										<span><small>7</small></span>
										<span></span>
										<span></span>
									</li>
									<li>
										<span><small>8</small></span>
										<span></span>
										<span></span>
									</li>
									<li>
										<span><small>9</small></span>
										<span></span>
										<span></span>
									</li>
									<li>
										<span><small>10</small></span>
										<span></span>
										<span></span>
									</li>
								</ul>		
					</div>

				</div><!-- main-l-box end -->

				<div class="main-r-box r">

					<div class="box-item">
						<div class="item-t">
							<div class="l">
								<p class="item-h">总发卡量</p>
								<p class="item-v">1,234,567,234</p>
							</div>
							<div class="l">
								<p class="item-h">本月发卡量</p>
								<p class="item-v">1,234,567,234</p>
							</div>
							<div class="l">
								<p class="item-h">今日发卡量</p>
								<p class="item-v">1,234,567,234</p>
							</div>

						</div>
						<div class="item-b">
							<div class="item-upload l">
							（上传量 <span>123,234,234</span>）
							</div>
							<div class="item-upload l">
							（上传量 <span>123,234,234</span>）
							</div>
							<div class="item-upload l">
							（上传量 <span>123,234,234</span>）
							</div>
						</div>
					</div>

					<div class="box-item">
						<div class="item-t">
							<div class="l">
								<p class="item-h">总用卡量</p>
								<p class="item-v">1,234,567,234</p>
							</div>
							<div class="l">
								<p class="item-h">本月用卡量</p>
								<p class="item-v">1,234,567,234</p>
							</div>
							<div class="l">
								<p class="item-h">今日用卡量</p>
								<p class="item-v">1,234,567,234</p>
							</div>

						</div>
						<div class="item-b">
							<div class="item-upload l">
							（上传量 <span>123,234,234</span>）
							</div>
							<div class="item-upload l">
							（上传量 <span>123,234,234</span>）
							</div>
							<div class="item-upload l">
							（上传量 <span>123,234,234</span>）
							</div>
						</div>
					</div>


					<!-- 深圳地图 -->
					<div class="map">深圳地图</div>


				</div><!--main-r-box end-->



			</div>

			<!-- 右侧 -->
			<div class="main-r r">

				<div class="main-r-container">
					<div class="chart-box">
						<p class="box-h">医院用卡量排行（今日）</p>	
					</div>

					<div class="chart-box">
						<p class="box-h">医院发卡量排行（今日）</p>	
					</div>
				</div>

			</div>
			
		</div>

	</div>
</body>
<script type="text/javascript">


//兼容IE Object.assign
if (typeof Object.assign != 'function') {
  Object.assign = function(target) {
    'use strict';
    if (target == null) {
      throw new TypeError('Cannot convert undefined or null to object');
    }

    target = Object(target);
    for (var index = 1; index < arguments.length; index++) {
      var source = arguments[index];
      if (source != null) {
        for (var key in source) {
          if (Object.prototype.hasOwnProperty.call(source, key)) {
            target[key] = source[key];
          }
        }
      }
    }
    return target;
  };
}




//获取时间字符串
function getinputDate(d,formatDate){
	if(d && (typeof d) == 'string'&&formatDate){
		return d.replace(/\s/ig,'').split(formatDate);
	}
	return ;
}


// 页面代码
    $(function () {
    	//加载图
        var load =function (padding) {
            return '<img src="./images/load.gif" style="display: block;width: 0.5rem;margin:0 auto;padding:'+padding+'" alt="">';
        };
        var lineDataMax = 200000;//柱状图阴影最大值预设  社康支付 和 医院支付
        var payMax = 1000000;//柱状图阴影最大值预设 支付宝 和 微信支付
        var mapChart = null;//地图对象
        var columnarChart3 = null;//社康渠道分布
        var columnarChart1=null;//社康机构支付排行
        var columnarChart2=null;//社康支付医院排行
        var chartLoadConfig = {//echart 加载样式
            text: '',
            color: '#20dbfd',
            textColor: '#000',
            maskColor: '#3953717a',
            zlevel: 0
        };
        //城市的配置
        var cityConfig = {
            '龙华区': {
                color: '#7947a8'
            },
            '光明新区': {
                color: '#159a8c'
            },
            '大鹏新区': {
                color: '#124292'
            },
            '坪山区': {
                color: '#474dad'
            },
            '龙岗区': {
                color: '#a14b0b'
            },
            '盐田区': {
                color: '#7d9a1d'
            },
            '罗湖区': {
                color: '#3a7cd5'
            },
            '福田区': {
                color: '#a16c0b'
            },
            '南山区': {
                color: '#1ca8eb'
            },
            '宝安区': {
                color: '#01d0fe'
            }
        };



        //initPage();


	    

//初始化函数 
        function initPage() {


            //初始化地图
            disposed(mapChart);
            mapChart = echarts.extendsMap('mapChart', {
                //bgColor: '#154e90', // 画布背景色
                bgColor: 'rgba(0,0,0,0)',
                mapName: '深圳市',    // 地图名
                goDown: false,       // 是否下钻
                // 下钻回调
                callback: function (name, option, instance) {
                    console.log(name, option, instance);
                },
                cityConfig: cityConfig,
                // 数据展示
                //data: [
                //]
            });



            //社康渠道分布
            disposed(columnarChart3);
            columnarChart3 = echarts.init(document.getElementById('columnarChart3'));


            //社康机构支付排行
            disposed(columnarChart1);
            columnarChart1 = echarts.init(document.getElementById('columnarChart1'));

            //社康支付医院排行
            disposed(columnarChart2);
            columnarChart2 = echarts.init(document.getElementById('columnarChart2'));

            //异步去请求数据
            setTimeout(function () {


                //请求页面数据
                $.ajax({
                    url: './js/data.json',
                    type: 'GET',
                    dataType: 'json',
                    beforeSend: function () {
                        //列表添加加载图片
                        $('#regionalInstitution').html(load('1.5rem 0'));
                        $('#regionalPayment').html(load('1.5rem 0'));
                        $('#boxList').html(load('0.65rem 0'));
                        mapChart.showLoading(chartLoadConfig);//显示地图加载动画
                        columnarChart3.showLoading(chartLoadConfig);//社康渠道分布
                        columnarChart1.showLoading(chartLoadConfig);//社康机构支付排行
                        columnarChart2.showLoading(chartLoadConfig);//社康支付医院排行
                    },
                    success: function (ret) {
                        console.log(ret);
                        if (JSON.stringify(ret) == '{}') {
                            console.log('没数据');
                            return
                        }
                        var areaPayStat = JSON.parse(ret.areaPayStat);//当前区支付排行统计数据
                        var instOpenStat = JSON.parse(ret.instOpenStat);//区域社康开通数量统计
                        var payChnStat = JSON.parse(ret.payChnStat);//支付渠道分布统计
                        var instPayStat = JSON.parse(ret.instPayStat);//社康机构支付排行统计
                        var instHosPayStat = JSON.parse(ret.instHosPayStat);//社康机构支付排行统计

                        //当前区支付排行统计 列表
                        //加逗号 format_number_arr(数组,keys:需要格式化的字段)
                       $('#regionalPayment').html(template( $('#regionalPaymentTpl').html() ,{data:format_number_arr(areaPayStat,['payNum','payAmt'])}) );
                       $('#boxList').html( template( $('#boxListTpl').html() ,{data:{tradeStat:format_number_arr(ret.tradeStat,['newAddInst','payAmt','payNum','todayPayAmt','todayPayNum','totalInstNum','totalPayAmt','totalPayNum','yesterdayPayAmt','yesterdayPayNum'])}}) );

                       $('#regionalInstitution').html( template( $('#regionalInstitutionTpl').html() , {data:format_number_arr(instOpenStat,['totalNum','newAddNum'])} ));


                        //加载地图
                        mapChart.hideLoading();//关闭地图加载动画
                        mapChart.setData(tranData(areaPayStat, ['name', 'payNum', 'payAmt'], ['areaName', 'payNum', 'payAmt']));//异步更新地图数据




                        //加载社康渠道分布 柱状是支付笔数，折线是支付金额
                        columnarChart3.hideLoading();
                        columnarChart3.setOption(columnarChartOption({
                            legend:['笔数','金额'],
                            seriesShadow : 20,
                            seriesData:[payMax,payMax],
                            seriesBar:{name:'笔数',data:objToArr(payChnStat,'payNum')},
                            seriesLine:{name:'金额',data:objToArr(payChnStat,'payAmt')},
                            xAxis:[{data: ['支付宝','微信']}],
                            yAxis:[{
                                        name: '笔数'
                                    }, {
                                        name: '金额'
                                    }]
                        }));

                        //社康机构支付排行
                        columnarChart1.hideLoading();
                        columnarChart1.setOption(columnarChartOption({
                            legend:['笔数','金额'],
                            seriesShadow : 20,
                            seriesData:fullArr(instPayStat.length,lineDataMax),
                            seriesBar:{name:'笔数',data:objToArr(instPayStat,'payNum')},
                            seriesLine:{name:'金额',data:objToArr(instPayStat,'payAmt')},
                            xAxis:[{data: objToArr(instPayStat,'name')}],
                            xAxisRotate:true,
                            grid: {height: '44%',top:'30'},
                            yAxis:[{
                                name: '笔数'
                            }, {
                                name: '金额'
                            }]
                        }));
                        //社康支付医院排行
                        columnarChart2.hideLoading();
                        columnarChart2.setOption(columnarChartOption({
                            legend:['笔数','金额'],
                            seriesShadow : 20,
                            seriesData:fullArr(instPayStat.length,lineDataMax),
                            seriesBar:{name:'笔数',data:objToArr(instHosPayStat,'payNum')},
                            seriesLine:{name:'金额',data:objToArr(instHosPayStat,'payAmt')},
                            xAxis:[{data: objToArr(instHosPayStat,'name')}],
                            xAxisRotate:true,
                            grid: {height: '44%',top:'30'},
                            yAxis:[{
                                name: '笔数'
                            }, {
                                name: '金额'
                            }]
                        }));

                        //适应屏幕
                        $(window).off('resize', winResize);
                        $(window).on('resize', winResize);

                        function winResize() {
                            mapChart.resize();
                            pieChart.resize();
                            columnarChart3.resize();
                            columnarChart1.resize();
                            columnarChart2.resize();
                        }


                    }
                });//请求页面数据end


            }, 0);

        }



//折柱混合
        function columnarChartOption (opt){

            var option = {
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross',
                        crossStyle: {
                            color: '#fff'
                        }
                    }
                },
                // toolbox: {
                //     feature: {
                //         dataView: {show: true, readOnly: false},
                //         magicType: {show: true, type: ['line', 'bar']},
                //         restore: {show: true},
                //         saveAsImage: {show: true}
                //     }
                // },
                legend: {
                    data:opt.legend,
                    textStyle:{
                        color:'#fff',
                        fontSize:8
                    },
                    itemWidth : 10,
                    itemHeight : 10
                },
                series: []
            };

            var xAxisObj = {
                    type: 'category',
                    axisPointer: {
                        type: 'shadow'
                    },
                    axisLabel: {
                        show: true,
                        textStyle: {
                            fontSize:8,
                            lineHeight:9,
                            color: "#fff" //轴文字颜色
                        }
                    },
                    nameTextStyle: {
                        color: "#fff"
                    },
                    axisLine : {
                        //轴线
                    },
                    axisTick : {
                        //刻度
                        show : false
                    }

                };

            if(opt.xAxisRotate){  //垂直文字
                xAxisObj.axisLabel.formatter = function(value, index) {
                    var arr = value.split('');
                    var label = '';
                    for (var i = 0; i < arr.length; i++) {
                        if (i>5){
                            label += '...';
                            break
                        }else{
                            label += arr[i] + '\n';
                        }
                    }
                    return label;
                }
            }

            if(opt.grid){
                option.grid = opt.grid;
            }


            var yAxisObj = {
                    type: 'value',
                    axisLabel: {
                        show: false,
                        textStyle: {
                            color: "#fff" ,//轴文字颜色
                            fontSize:8
                        }
                    },
                    nameTextStyle: {
                        color: "#fff"
                    },
                    splitLine : {
                        //网格线
                        show : false
                    },
                    axisTick : {
                        //刻度
                        show : false
                    },
                    axisLabel : {
                        show :false
                    }
                };
            //阴影
            var seriesShadow = {
                // For shadow
                    type: 'bar',
                    itemStyle: {
                        normal: {color: '#1f3459'}
                    },
                    barGap:'-100%',
                    tooltip: {
                        show:false
                    },
                    data: opt.seriesData,
                    animation: false
                };


            //柱状
            var  seriesBar = {
                    type:'bar',
                    name:opt.seriesBar.name,
                    data:opt.seriesBar.data,
                    itemStyle : {
                        // 线性渐变，前四个参数分别是 x0, y0, x2, y2, 范围从 0 - 1，相当于在图形包围盒中的百分比，如果 globalCoord 为 `true`，则该四个值是绝对的像素位置
                        color: {
                            type: 'linear',
                            x: 0.5,
                            y: 0.5,
                            x2: 1,
                            y2: 0.5,
                            colorStops: [{
                                offset: 0, color: '#75d9ea' // 0% 处的颜色
                            }, {
                                offset: 1, color: '#0381ff' // 100% 处的颜色
                            }],
                            global: false // 缺省为 false
                        }
                    }
                };

                if(opt.seriesShadow){
                    seriesShadow.barWidth = opt.seriesShadow;
                    seriesBar.barWidth = opt.seriesShadow;
                }
                //折线
                var  seriesLine = {
                    name:opt.seriesLine.name,
                    data:opt.seriesLine.data,
                    type:'line',
                    itemStyle : {
                        color : "#fff"
                    },
                    yAxisIndex: 1
                };

            option.xAxis = concatObj(xAxisObj,opt.xAxis) ;
            option.yAxis = concatObj(yAxisObj,opt.yAxis) ;
            option.series.push(seriesShadow);
            option.series.push(seriesBar);
            option.series.push(seriesLine);
            return option;
        }

//合并对象
        function concatObj(o,arr) {
            var a= [];
            for ( var i = 0 ; i<arr.length ; i++) {
                var item = Object.assign({},o) ;
                for (var key in arr[i] ) {
                    item[key] = arr[i][key];
                }
                a.push(item)
            }
            return  a;
        }

// 数值转换   3为加,  大于等于7为 加单位(万)
       // format_number_arr(数组,keys:需要格式化的字段)
        function format_number_arr(arr,keys) {

            if(arr instanceof Array){
                for (var i=0;i<arr.length;i++){//是数组
                    for (var j=0;j<keys.length;j++){
                        arr[i][keys[j]] = format_number(arr[i][keys[j]]);
                    }
                }
            }else{//是对象
                for (var j=0;j<keys.length;j++){
                    arr[keys[j]] = format_number(arr[keys[j]]);
                }
            }
            return arr;
        }


        function format_number(n){
            if(isNaN(Number(n))){ return 0;}
            var b=parseInt(n).toString();
            var len=b.length;
            var w = '', f = '' ;
            if(len>=7){
                //大于7 要加 万字
                w = '万';
                f = '.' + ((b/10000).toFixed(2)).toString().split('.')[1];
                b = b.slice(0,b.length-4);
                len = b.length;
            }

            if(len<=3){return b+f+w;}

            var r=len%3,s = r>0?b.slice(0,r)+","+b.slice(r,len).match(/\d{3}/g).join(","):b.slice(r,len).match(/\d{3}/g).join(",");

            return s+f+w;
        }
       

        //转换数据 arr需要转换的数据   keys转换后字段名称(顺序和长度得与arrkey一致)   arrkey转换的字段名字(顺序和长度得与keys一致)
        function tranData(arr,keys,arrkey) {
            var a = [];
            for (var i=0; i < arr.length;i++) {
                var o = {};
                for (var j=0; j < keys.length;j++) {
                    o[keys[j]] = arr[i][arrkey[j]];
                }
                a.push(o)
            }
            return a;
        }
        
        function objToArr(o,key) {
            var arr = [];
            for (var i=0; i < o.length;i++) {
                for (var k in o[i]) {
                    if (k == key) {
                        arr.push(o[i][key]);
                    }
                }
            }
            return arr;
        }

        function fullArr(length,val) {
            var arr = [];
            for (var i=0; i < length;i++) {
                arr.push(val);
            }
            return arr;
        }

        //释放图标对象

        function disposed(chart) {
            if(chart!=null){//初始化值为null  不释放
                //判断是否释放
                if(!chart.isDisposed()){
                    chart.dispose();
                }
            }
        }

        //时间段


// script end
    });

</script>
</html>