<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
    <link rel="stylesheet" type="text/css" href="./project/css/normalize.css">
    <script type="text/javascript" src="./project/js/jquery-1.9.1.js"></script>
    <script type="text/javascript" src="./project/js/echarts.min.js"></script>
	<style type="text/css">
		html,body{
			width: 100%;
			height: 100%;
		}
        body{
            background:url(./project/images/bigbg.png);
            background-size: 100% 100%;
        }
        .head{
            background:url(./project/images/h_bg.png) no-repeat;
            background-size: 100%;
            min-width: 756px;
            height: 12%;
        }
        .bg{
            width: 50%;
            height: 50%;
            background:url(./project/images/bg.png) no-repeat;
            background-size: 100% 100%;
        }
        #chart-panel{
            width: 100%;
            height: 100%;
        }
        #chart-panel2,#chart-panel3,#chart-panel4{
            width: 50%;
            height: 50%;
        }

	</style>
</head>
<body>
<div class="head">
</div>
<a href="javascript:;"  id="setOption">setOption</a>
<div class="bg">
    <div id="chart-panel" style=""></div>
</div>
<div id="chart-panel2" style=""></div>
<div id="chart-panel3" style=""></div>
<div id="chart-panel4" style=""></div>
</body>
<script type="text/javascript">
var guangdong = "./project/js/guangdong.json";
var shenzhen = "./project/js/shenzhenshi.json";


echarts.extendsMap = function(id, opt){
    // 实例
    var chart = this.init(document.getElementById(id));
    chart.showLoading();

    var curGeoJson = {};
    //下钻的json数据
    var cityMap = {
        "深圳市": shenzhen,
    };
    //点的位置
    var geoCoordMap = {
        '深圳市': [ 114.027099609375,22.717923537632178],
        '龙华区': [114.027099609375,22.717923537632178],
        '光明区':[113.93852233886719,22.77301594961187],
        '大鹏新区':[114.50431823730469,22.607038308040828],
        '坪山区':[114.35050964355469,22.67738161936916],
        '龙岗区':[114.25437927246094,22.743889395219064],
        '盐田区':[114.27635192871094,22.574072303523796],
        '罗湖区':[114.14794921875,22.553781610660607],
        '福田区':[114.04769897460938,22.52016858599439],
        '南山区':[113.96186828613281,22.585484505801283],
        '宝安区':[113.82865905761719,22.642531328085155]
    };
    //点的颜色
    var levelColorMap = {
        '1': 'rgba(241, 109, 115, .8)',
        '2': 'rgba(255, 235, 59, .7)',
        '3': 'rgba(147, 235, 248, 1)'
    };

    //默认配置
	var defaultOpt = {
		mapName: 'china',     // 地图展示
		goDown: false,        // 是否下钻
		bgColor: '#404a59',   // 画布背景色
        activeArea: [],       // 区域高亮,同echarts配置项
        data: [],
        // 下钻回调(点击的地图名、实例对象option、实例对象)
        callback: function(name, option, instance){}
	};
	if(opt) opt = this.util.extend(defaultOpt, opt);
	
	// 层级索引  标题
	var name = [opt.mapName];
	var idx = 0;
	var pos = {
		leftPlus: 50,//2级标题偏移
		leftCur: 8,//2级标题偏移
		left: 0,//1级标题偏移
		top: 10//1级标题偏移
	};
    
    //标题的箭头
	var line = [[0, 0], [8, 11], [0, 22]];
    // style 通用的样式
	var style = {
		font: '18px "Microsoft YaHei", sans-serif',
		textColor: '#eee',
		lineColor: 'rgba(147, 235, 248, .8)'
	};

    var handleEvents = {
        /**
         * i 实例对象
         * o option
         * n 地图名
        **/
        resetOption: function(i, o, n){
            var breadcrumb = this.createBreadcrumb(n);//设置标题组件
            
            var j = name.indexOf(n);
            var l = o.graphic.length;
            if(j < 0){
                o.graphic.push(breadcrumb);
                o.graphic[0].children[0].shape.x2 = 145;
                o.graphic[0].children[1].shape.x2 = 145;
                if(o.graphic.length > 2){
                    for(var x = 0; x < opt.data.length; x++){
                        if(n === opt.data[x].name + '市'){
                            o.series[0].data = handleEvents.initSeriesData([opt.data[x]]);
                            break;
                        }else o.series[0].data = [];
                    }
                };
                name.push(n);
                idx++;
            }else{
                o.graphic.splice(j + 2, l);
                if(o.graphic.length <= 2){
                    o.graphic[0].children[0].shape.x2 = 60;
                    o.graphic[0].children[1].shape.x2 = 60;
                    o.series[0].data = handleEvents.initSeriesData(opt.data);
                };
                name.splice(j + 1, l);
                idx = j;
                pos.leftCur -= pos.leftPlus * (l - j - 1);
            };

            o.geo.map = n;
            o.geo.zoom = 0.4;
            i.clear();
            i.setOption(o);
            this.zoomAnimation();
            opt.callback(n, o, i);
        },

        /**
         * name 地图名  标题组件
        **/
        createBreadcrumb: function(name){
            var cityToPinyin = {
                "深圳市": "shenzhen",//地图中文 : 地图拼音设置
            };
            var breadcrumb = {
                type: 'group',
                id: name,
                left: pos.leftCur + pos.leftPlus,
                top: pos.top + 3,
                children: [{
                    type: 'polyline',
                    left: -90,
                    top: -5,
                    shape: {
                        points: line
                    },
                    style: {
                        stroke: '#fff',
                        key: name
                        // lineWidth: 2,
                    },
                    onclick: function(){
                        var name = this.style.key;
                        handleEvents.resetOption(chart, option, name);
                    }
                }, {
                    type: 'text',
                    left: -68,
                    top: 'middle',
                    style: {
                        text: name,
                        textAlign: 'center',
                        fill: style.textColor,
                        font: style.font
                    },
                    onclick: function(){
                        var name = this.style.text;
                        handleEvents.resetOption(chart, option, name);
                    }
                }, {
                    type: 'text',
                    left: -68,
                    top: 10,
                    style: {

                        name: name,
                        text: cityToPinyin[name] ? cityToPinyin[name].toUpperCase() : '',
                        textAlign: 'center',
                        fill: style.textColor,
                        font: '12px "Microsoft YaHei", sans-serif',
                    },
                    onclick: function(){
                        // console.log(this.style);
                        var name = this.style.name;
                        handleEvents.resetOption(chart, option, name);
                    }
                }]
            }

            pos.leftCur += pos.leftPlus;

            return breadcrumb;
        },

        // 设置effectscatter
        initSeriesData: function(data){
            var temp = [];
            for(var i = 0;i < data.length;i++){
                var geoCoord = geoCoordMap[data[i].name];
                if(geoCoord){
                    temp.push({
                        name: data[i].name,
                        value: geoCoord.concat(data[i].value, data[i].level)
                    });
                }
            };
            console.log(JSON.stringify(temp),'data')
            return temp;
        },

        zoomAnimation: function(){
            var count = null;
            var zoom = function(per){
                if(!count) count = per;
                count = count + per;
                // console.log(per,count);
                chart.setOption({
                    geo: {
                        zoom: count
                    }
                });
                if(count < 1) window.requestAnimationFrame(function(){
                    zoom(0.2);
                });
            };
            window.requestAnimationFrame(function(){
                zoom(0.2);
            });
        }
    };
    
    //初始化标题的配置
    var option = {
    	backgroundColor: opt.bgColor,
    	graphic: [{  //左上角按钮
    		type: 'group',
    	/*	left: pos.left,
	        top: pos.top - 4,
    		children: [{
    			type: 'line',//上面的线
    			left: 0,
        		top: -20,
        		shape: {
                    x1: 0,
                    y1: 0,
                    x2: 60,
                    y2: 0
                },
        		style: {
        			stroke: style.lineColor,
        		}
			}, {
    			type: 'line',//下面的线
    			left: 0,
        		top: 20,
		        shape: {
                    x1: 0,
                    y1: 0,
                    x2: 60,
                    y2: 0
                },
                style: {
                    stroke: style.lineColor,
                }
    		}]
    	}, {
        	id: name[idx],
        	type: 'group',
        	left: pos.left + 2,
        	top: pos.top,
        	children: [{
        		type: 'polyline',
        		left: 90,
        		top: -12,
        		shape: {
                    points: line
                },
        		style: {
                    stroke: 'transparent',
        			key: name[0]
        		},
        		onclick: function(){
        			var name = this.style.key;
	        		handleEvents.resetOption(chart, option, name);
	        	}
        	}, {
        		type: 'text',//标题字
        		left: 0,
                top: 'middle',
        		style: {
	        		text: name[0] === '深圳市' ? '深圳市' : name[0],
	        		textAlign: 'center',
	        		fill: style.textColor,
	        		font: style.font
	        	},
	        	onclick: function(){
	        		handleEvents.resetOption(chart, option, '深圳市');
	        	}
        	}, {
                type: 'text',//标题拼音
                left: 0,
                top: 10,
                style: {
                    text: 'shenzhenshi',
                    textAlign: 'center',
                    fill: style.textColor,
                    font: '12px "Microsoft YaHei", sans-serif',
                },
                onclick: function(){
                    handleEvents.resetOption(chart, option, '深圳市');
                }
            }] */
        }],
        geo: {//地图块
        	map: opt.mapName,
            roam: true,//拖动,鼠标滚轴
            zoom: 2,
        	label: {
                normal: {
                    show: true,//地图块中的名字
                    textStyle: {
                        color: '#fff'
                    }
                },
                emphasis: {
                    textStyle: {//地图块中的名字 的 hover 
                        color: '#fff'
                    }
                }
            },
            itemStyle: {//每个地图块
                normal: {
                    //borderColor: 'rgba(147, 235, 248, 1)',//每个地图块的边框颜色
                    borderColor: '#5491be',
                    borderWidth: 1,
                    areaColor: {//填充的颜色
                        type: 'radial',
                        x: 0.5,
                        y: 0.5,
                        r: 0.8,
                        colorStops: [{
                            offset: 0, 
                            //color: 'rgba(147, 235, 248, 0)' // 0% 处的颜色
                            color: '#174e87'
                        }, {
                            offset: 1, 
                            //color: 'rgba(147, 235, 248, .2)' // 100% 处的颜色
                            color: '#356798'
                        }],
                        globalCoord: false // 缺省为 false
                    },
                    shadowColor: 'rgba(128, 217, 248, 1)',
                    // shadowColor: 'rgba(255, 255, 255, 1)',
                    // shadowOffsetX: -2,
                    // shadowOffsetY: 2,
                    // shadowOffsetX: -1,
                    // shadowOffsetY: 1,
                    // shadowBlur: 10
                },
                emphasis: {//每个地图块的hover
                    areaColor: '#389BB7',
                    borderWidth: 0
                }
            },
            regions: opt.activeArea.map(function(item){
                if(typeof item !== 'string'){
                    return {
                        name: item.name,
                        itemStyle: {
                            normal: {
                                areaColor: item.areaColor || '#389BB7'
                            }
                        },
                        label: {
                            normal: {
                                show: item.showLabel,
                                textStyle: {
                                    color: '#fff'
                                }
                            }
                        }
                    }
                }else{
                    return {
                        name: item,
                        itemStyle: {
                            normal: {
                                borderColor: '#91e6ff',
                                areaColor: '#389BB7'
                            }
                        }
                    }
                }
            })
        },
        tooltip : {
            formatter: function (params, ticket, callback) {
                return params.name+"<br>value:"+params.value[2];
            }
        },
        series: [{//数据点的样式
            name: 'point',
            type: 'effectScatter',
            coordinateSystem: 'geo',
            // symbol: 'diamond',
            showEffectOn: 'render',
            rippleEffect: {
                period: 15,
                scale: 3,
                brushType: 'fill'
            },
            hoverAnimation: true,
            itemStyle: {
                normal: {
                    color: function(params){
                        return levelColorMap[params.value[3]];
                    },
                    shadowBlur: 10,
                    shadowColor: '#333'
                }
            },
            data: handleEvents.initSeriesData(opt.data)
        }]
    };
    chart.hideLoading();
    chart.setOption(option);
    // 添加事件
    chart.on('click', function(params){
        var _self = this;
    	if(opt.goDown && params.name !== name[idx]){
            if(cityMap[params.name]){
                var url = cityMap[params.name];
                $.get(url, function(response){
                    // console.log(response);
                    curGeoJson = response;
                    echarts.registerMap(params.name, response);
                    handleEvents.resetOption(_self, option, params.name);
                });
            }
    	}
    });

    chart.setMap = function(mapName){
        var _self = this;
        if(mapName.indexOf('市') < 0) mapName = mapName + '市';
        var citySource = cityMap[mapName];
        if(citySource){
            var url = './map/' + citySource + '.json';
            $.get(url, function(response){
                // console.log(response);
                curGeoJson = response;
                echarts.registerMap(mapName, response);
                handleEvents.resetOption(_self, option, mapName);
            });
        }
         handleEvents.resetOption(this, option, mapName);
    };

    return chart;
};


$.getJSON(shenzhen, function(geoJson){
    echarts.registerMap('深圳市', geoJson);
    var myChart = echarts.extendsMap('chart-panel', {
    	//bgColor: '#154e90', // 画布背景色
        bgColor: 'rgba(0,0,0,0)' ,
    	mapName: '深圳市',    // 地图名
    	goDown: false,       // 是否下钻
    	// 下钻回调
    	callback: function(name, option, instance){
    		console.log(name, option, instance);
    	},
        // 数据展示            	
    	data: [
            {
        	   name: '龙华区',
        	   value: 1,
        	   level: 2
            },
            {
                name:'光明区',
                value: 2,
                level: 2
            },
            {
                name:'大鹏新区',
                value: 3,
                level: 3
            },
            {
                name:'坪山区',
                value: 4,
                level: 2
            },
            {
                name:'龙岗区',
                value: 5,
                level: 2
            },
            {
                name:'盐田区',
                value: 6,
                level: 2
            },
            {
                name:'罗湖区',
                value: 7,
                level: 2
            },
            {
                name:'福田区',
                value: 8,
                level: 2
            },
            {
                name:'南山区',
                value: 9,
                level: 1
            },
            {
                name:'宝安区',
                value: 10,
                level: 2
            },
        ]
    });


setOption.onclick=function(){
    //异步更新数据
    myChart.setOption({
        series:[{
            name: 'point',
            data:[
                    {"name":"龙华区","value":[114.027099609375,22.717923537632178,1,2]}
                    ,{"name":"光明区","value":[113.93852233886719,22.77301594961187,2,2]}
                    ,{"name":"大鹏新区","value":[114.50431823730469,22.607038308040828,3,3]}
                    ,{"name":"坪山区","value":[114.35050964355469,22.67738161936916,4,2]}
                    ,{"name":"龙岗区","value":[114.25437927246094,22.743889395219064,5,2]}
                    ,{"name":"盐田区","value":[114.27635192871094,22.574072303523796,6,1]}
                    ,{"name":"罗湖区","value":[114.14794921875,22.553781610660607,7,2]}
                    ,{"name":"福田区","value":[114.04769897460938,22.52016858599439,8,2]}
                    ,{"name":"南山区","value":[113.96186828613281,22.585484505801283,9,1]}
                    ,{"name":"宝安区","value":[113.82865905761719,22.642531328085155,100,1]}
                ]
            }]
        }) 
    }

    window.onresize=function(){
        //适应屏幕宽度
        //myChart.resize();
    }

})















//横向图标


// var baifenbi = [1.000, 0.833, 0.966, 0.897, 0.915, 0.881, 0.951, 0.949];
// var grayBar = [1, 1, 1, 1, 1, 1, 1, 1];
// var paiming = ['环境部署', 7, 6, 5, 4, 3, 2, 1];

// var option2 = {
//     // title: {
//     //     text: '2018年累计处理需求/问题统计(合计:786/847)',
//     //     left: 'center'
//     // },
//      tooltip : {
//             formatter: function (params, ticket, callback) {
//                 return params.name+"<br>value:"+params.value;
//             }
//         },
//     color: ['#61A8FF'], //进度条颜色
//      grid: {
//          left: '0',  //如果离左边太远就用这个......
//          //right: '14%',
//          bottom: '5%',
//          top: '5%',
//          containLabel: true
//      },
//     xAxis: [{
//             show: false,
//         },
//         //由于下边X轴已经是百分比刻度了,所以需要在顶部加一个X轴,刻度是金额,也隐藏掉
//         {
//             show: false,
//         }
//     ],
//     yAxis: {
//         type: 'category',
//         axisLabel: {
//             color: '#00C5CD',
//             formatter: function(value) {
//                 //富文本固定格式{colorName|这里填你想要写的内容}
//                 return value
//             },
//             fontSize: 20,
//             padding: [5, 5, 5, 5]
//         },
//         axisTick: {
//             show: false, //隐藏Y轴刻度
//         },
//         axisLine: {
//             show: false, //隐藏Y轴线段
//         },

//         data: paiming,
//     },
//     series: [
//         //背景色--------------------我是分割线君------------------------------//
//         {
//             show: true,
//             type: 'bar',
//             barGap: '-100%',
//             barWidth: '35%', //统计条宽度 
//             itemStyle: {
//                 normal: {
//                     color: 'rgba(0,0,0,0.1)'
//                 },
//             },
//             z: 1,
//             data: grayBar,
//         },
//         //蓝条--------------------我是分割线君------------------------------//
//         {
//             show: true,
//             type: 'bar',
//             barGap: '-100%',
//             barWidth: '35%', //统计条宽度
//             itemStyle: {
//                 normal: {
//                     color: {
//                         colorStops: [{
//                              offset: 0,
//                              color: '#3dc0e9' // 0% 处的颜色
//                          }, {
//                              offset: 1,
//                              color: '#45e3cf' // 100% 处的颜色
//                          }],
//                         globalCoord: false, // 缺省为 false

//                     }
//                 },
//             },
//             max: 1,
//             label: {
//                 normal: {
//                     show: true,
//                     textStyle: {
//                         color: '#fff', //百分比颜色
//                     },
//                     position: 'inside',
//                     //百分比格式
//                     formatter: function(data) {
//                         return (baifenbi[data.dataIndex] * 100).toFixed(1) + '%';
//                     },
//                 }
//             },
//             z: 2,
//             data: baifenbi,
//         },

//     ]
// };

var option2 = {
    title: {
        text: '世界人口总量',
        subtext: '数据来自网络'
    },
    tooltip: {
        trigger : 'item',
    },
    legend: {
        data: ['2012年']
        
    },
    grid: {
        left: '3%',
        right: '4%',
        bottom: '3%',
        containLabel: true
    },
    xAxis: {
        show:false,
    },
    yAxis: {
        type: 'category',
        data: ['巴西','印尼','美国','印度','中国','世界人口(万)'],
                type: 'category',
        axisLabel: {
            color: '#00C5CD',
            formatter: function(value) {
                //富文本固定格式{colorName|这里填你想要写的内容}
                return value
            },
            fontSize: 20,
            padding: [5, 5, 5, 5]
        },
        axisTick: {
            show: false, //隐藏Y轴刻度
        },
        axisLine: {
            show: false, //隐藏Y轴线段
        },
    },
    series: [
        {
            show: true,
            type: 'bar',
            barGap: '-100%',
            itemStyle: {
                normal: {
                    color: 'rgba(0,0,0,0.1)'
                },
            },
            tooltip: {
                show:false
            },
            z: 1,
            data: [999999, 999999, 999999, 999999, 999999, 999999]
        },
        {
            name: '2012年',
            type: 'bar',
            z:2,
           itemStyle: {
                normal: {
                    color: {
                        colorStops: [{
                             offset: 0,
                             color: '#3dc0e9' // 0% 处的颜色
                         }, {
                             offset: 1,
                             color: '#45e3cf' // 100% 处的颜色
                         }],
                        globalCoord: false, // 缺省为 false

                    }
                },
            },
            label: {
                normal: {
                    show: true,
                    textStyle: {
                        color: '#fff', //百分比颜色
                    },
                    position: 'inside',
                    //百分比格式
                    formatter: function(data) {
                        return data.value;
                    },
                }
            },
            data: [19325, 23438, 31000, 121594, 134141, 681807]
        }
    ]
};
var myChart2=echarts.init(document.getElementById('chart-panel2'));
myChart2.setOption(option2);








//漏斗图
var option3 = {
    title: {
        text: '漏斗图',
        subtext: '纯属虚构',
        textStyle : {
            color:"#fff",
        },
        bottom : '10px'
    },
    tooltip: {
        trigger: 'item',
        formatter: "{a} <br/>{b} : {c}%"
    },
    // toolbox: {
    //     feature: {
    //         dataView: {readOnly: false},
    //         restore: {},
    //         saveAsImage: {}
    //     }
    // },
    legend: {
        data: ['健康深圳APP','深圳卫计委公众号','医院自助机'],
        textStyle : {
            color:"#fff",
        }
    },
    calculable: true,
    series: [
        {
            name:'漏斗图',
            type:'funnel',
            left: '10%',
            top: 60,
            bottom: 60,
            //width: '80%',
            // min: 0,
            // max: 100,
            // minSize: '0%',
            // maxSize: '100%',
            sort: 'descending',
            gap: 0,
            label: {
                show: true,
                position: 'inside',
                formatter:function(v){
                    console.log(v)
                    return v.name+'\n\n'+v.value+'张';
                }
            },
            labelLine: {
                length: 10,
                lineStyle: {
                    width: 1,
                    type: 'solid'
                }
            },
            itemStyle: {
                borderWidth: 0
            },
            // emphasis: {
            //     label: {
            //         fontSize: 20
            //     }
            // },
            data: [
                {value: 1360, name: '健康深圳APP'},
                {value: 552, name: '深圳卫计委公众号'},
                {value: 201, name: '医院自助机'},
            ]
        }
    ]
};


var myChart3=echarts.init(document.getElementById('chart-panel3'));
myChart3.setOption(option3);








//折柱混合

var option4 = {
    tooltip: {
        trigger: 'axis',
        axisPointer: {
            type: 'cross',
            crossStyle: {
                color: '#999'
            }
        }
    },
    toolbox: {
        feature: {
            dataView: {show: true, readOnly: false},
            magicType: {show: true, type: ['line', 'bar']},
            restore: {show: true},
            saveAsImage: {show: true}
        }
    },
    legend: {
        data:['蒸发量','平均温度']
    },
    xAxis: [
        {
            type: 'category',
            data: ['1月','2月','3月','4月','5月','6月','7月','8月','9月','10月','11月','12月'],
            axisPointer: {
                type: 'shadow'
            }
        }
    ],
    yAxis: [
        {
            type: 'value',
            name: '水量',
            min: 0,
            max: 250,
            interval: 50,
            axisLabel: {
                formatter: '{value} ml'
            }
        },
        {
            type: 'value',
            name: '温度',
            min: 0,
            max: 25,
            interval: 5,
            axisLabel: {
                formatter: '{value} °C'
            }
        }
    ],
    series: [
       { // For shadow
            type: 'bar',
            itemStyle: {
                normal: {color: 'rgba(0,0,0,0.5)'}
            },
            barGap:'-100%',
            data: [250,250,250,250,250,250,250,250,250,250,250,250],
            animation: false
        },
        {
            name:'蒸发量',
            type:'bar',
            data:[2.0, 4.9, 7.0, 23.2, 25.6, 76.7, 135.6, 162.2, 32.6, 20.0, 6.4, 3.3]
        },
        {
            name:'平均温度',
            type:'line',
            yAxisIndex: 1,
            data:[2.0, 2.2, 3.3, 4.5, 6.3, 10.2, 20.3, 23.4, 23.0, 16.5, 12.0, 6.2]
        }
    ]
};


var myChart4=echarts.init(document.getElementById('chart-panel4'));
myChart4.setOption(option4);




</script>
</html>